<!DOCTYPE html>
<html lang="zh-cn">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>CMU15445作业 - M-071的甲板</title>
  
    <link rel="shortcut icon" href="/images/favicon.png">
  
  
    <link rel='manifest' href='/images/manifest.json'>
  

  
  
  
  <meta property="og:title" content="CMU15445作业 - M-071的甲板" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="https://wsyunine.github.io/2024/12/09/CMU15445-learning-note-hwk/index.html" />
  
  <meta property="og:image" content="/images/CMU15445.webp" />
  
  <meta property="og:article:published_time" content="2024-12-08T16:58:39.000Z" />
  
  <meta property="og:article:author" content="wsy_jim" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
    
<link rel="stylesheet" href="/css/giscus.css">

  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 6.3.0"></head>
    <body
        data-color-scheme="light/dark/auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="6"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">M-071的甲板</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">主页</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/wsyunine" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="https://discord.gg/wsy_jim" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item" href="/tags">Tags</a>
            
            
            
            <a class="nav-item" href="/categories">Categories</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/公开课/">公开课</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>December</span>
            <span>9,</span>
            <span>2024</span>
        </div>
        

        <h1 class="title">CMU15445作业</h1>
    </div>

    <div class="divider"></div>

    <div class="content ">
        <p>学一学CMU的15445，<a target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/fall2024/">课程地址</a></p>
<span id="more"></span>
<h2 id="homework-1---sql">Homework #1 - SQL</h2>
<p>要求在 <code>SQLite</code> 和 <code>Duckdb</code> 上编写一些查询代码并执行，还是有些难度的</p>
<ol type="1">
<li><p>查询至少得过一枚奖牌的教练（即相同国家和项目的运动员或队伍得过至少一枚奖牌的教练），并按以奖牌数为第一关键字降序、以名字为第二关键字字典序排序</p>
<p>分析：</p>
<p>首先我们要找出教练的国家和项目</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ch.name, ch.country_code, ch.discipline <span class="keyword">from</span> coaches <span class="keyword">as</span> ch;</span><br></pre></td></tr></table></figure></p>
<p>然后要找出奖牌的项目和胜者 code</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> m.discipline, m.winner_code <span class="keyword">from</span> medals <span class="keyword">as</span> m;</span><br></pre></td></tr></table></figure></p>
<p>将两者通过 discipline 结合</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline;</span><br></pre></td></tr></table></figure></p>
<p>先找运动员</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tmp.ch_name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, athletes <span class="keyword">as</span> a</span><br><span class="line"><span class="keyword">where</span> tmp.win <span class="operator">=</span> a.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> a.country_code</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line"><span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<p>再找队伍</p>
<p>这个地方需要注意，队伍 relation 中一个 tuple 表示一个队员，所以一个队伍可能会有很多 tuple，我们需要的只是 code 和 country_code，所以需要子查询</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> code, country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code;</span><br></pre></td></tr></table></figure></p>
<p>一个很有意思的事情，在 <code>SQLite</code> 中，上面的语句是可以正常执行的，但是在 <code>Duckdb</code> 中会报错，因为机器不知道 <code>code</code> 和 <code>country_code</code> 之间存在关系，即不同的 <code>code</code> 对应不同的 <code>country_code</code>，所以若只以 <code>code</code> 分组会导致机器不知道要拿组内哪个 <code>country_code</code> 的值来输出，产生不准确的查询，要么也以 <code>country_code</code> 分组，要么加 <code>any_value()</code> 函数，表示随意取一个值，但是在 <code>SQLite</code> 中，没有这个函数</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> code, any_value(country_code) <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> tmp.ch_name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, (<span class="keyword">select</span> code, country_code <span class="keyword">as</span> ct <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">where</span> tmp.win <span class="operator">=</span> t.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> t.ct</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line"><span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<p>最后排序（丑的一批）</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQLite</span></span><br><span class="line"><span class="keyword">select</span> q1.name, <span class="built_in">sum</span>(c) <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	(</span><br><span class="line">        <span class="keyword">select</span> tmp.ch_name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> tmp.win <span class="operator">=</span> a.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> a.country_code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line">        <span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> tmp.ch_name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, (<span class="keyword">select</span> code, country_code <span class="keyword">as</span> ct <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t</span><br><span class="line">        <span class="keyword">where</span> tmp.win <span class="operator">=</span> t.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> t.ct</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line">        <span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">    ) <span class="keyword">as</span> q1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> q1.name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s <span class="keyword">desc</span>, q1.name;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Duckdb</span></span><br><span class="line"><span class="keyword">select</span> q1.name, <span class="built_in">sum</span>(c) <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	(</span><br><span class="line">        <span class="keyword">select</span> tmp.ch_name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> tmp.win <span class="operator">=</span> a.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> a.country_code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line">        <span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> tmp.ch_name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (<span class="keyword">select</span> ch.name <span class="keyword">as</span> ch_name, ch.country_code <span class="keyword">as</span> ch_ct, m.winner_code <span class="keyword">as</span> win <span class="keyword">from</span> coaches <span class="keyword">as</span> ch, medals <span class="keyword">as</span> m <span class="keyword">where</span> ch.discipline <span class="operator">=</span> m.discipline) <span class="keyword">as</span> tmp, (<span class="keyword">select</span> code, any_value(country_code) <span class="keyword">as</span> ct <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t</span><br><span class="line">        <span class="keyword">where</span> tmp.win <span class="operator">=</span> t.code <span class="keyword">and</span> tmp.ch_ct <span class="operator">=</span> t.ct</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tmp.ch_name</span><br><span class="line">        <span class="keyword">having</span> c <span class="operator">&gt;</span> <span class="number">0</span></span><br><span class="line">    ) <span class="keyword">as</span> q1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> q1.name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s <span class="keyword">desc</span>, q1.name;</span><br></pre></td></tr></table></figure></p></li>
<li><p>查询所有柔道选手的姓名和奖牌数，并按以奖牌数为第一关键字降序、以名字为第二关键字字典序排序</p>
<p>分析：</p>
<p>首先查询所有柔道选手</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> athletes <span class="keyword">where</span> disciplines <span class="operator">=</span> "['Judo']";</span><br></pre></td></tr></table></figure></p>
<p>还有一个很有意思的事情就是 <code>Duckdb</code> 不支持双引号，所以你需要这样写</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> athletes <span class="keyword">where</span> disciplines <span class="operator">=</span> <span class="string">'[''Judo'']'</span>;</span><br></pre></td></tr></table></figure></p>
<p>然后选出所有的柔道奖牌</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> winner_code <span class="keyword">from</span> medals <span class="keyword">where</span> discipline <span class="operator">=</span> <span class="string">'Judo'</span>;</span><br></pre></td></tr></table></figure></p>
<p>选手可能自己拿牌子，也可能通过队伍拿牌子，但是牌子数量是一定的</p>
<p>先算个人拿的牌子</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.name, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> athletes <span class="keyword">as</span> a, medals <span class="keyword">as</span> m</span><br><span class="line"><span class="keyword">where</span> a.disciplines <span class="operator">=</span> "['Judo']" <span class="keyword">and</span> m.discipline <span class="operator">=</span> <span class="string">'Judo'</span> <span class="keyword">and</span> m.winner_code <span class="operator">=</span> a.code</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.name;</span><br></pre></td></tr></table></figure></p>
<p>再算在队伍中拿的牌子</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.name <span class="keyword">as</span> name, t.code <span class="keyword">as</span> t_code</span><br><span class="line"><span class="keyword">from</span> athletes <span class="keyword">as</span> a, teams <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">where</span> a.disciplines <span class="operator">=</span> "['Judo']" <span class="keyword">and</span> a.code <span class="operator">=</span> t.athletes_code;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> p.name, <span class="built_in">count</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">	<span class="keyword">select</span> a.name <span class="keyword">as</span> name, t.code <span class="keyword">as</span> t_code</span><br><span class="line">    <span class="keyword">from</span> athletes <span class="keyword">as</span> a, teams <span class="keyword">as</span> t</span><br><span class="line">    <span class="keyword">where</span> a.disciplines <span class="operator">=</span> "['Judo']" <span class="keyword">and</span> a.code <span class="operator">=</span> t.athletes_code</span><br><span class="line">) <span class="keyword">as</span> p, medals <span class="keyword">as</span> m</span><br><span class="line"><span class="keyword">where</span> p.t_code <span class="operator">=</span> m.winner_code</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> p.name;</span><br></pre></td></tr></table></figure></p>
<p>再合并排序，注意最后要加上奖牌数为 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.05ex;" xmlns="http://www.w3.org/2000/svg" width="1.131ex" height="1.557ex" role="img" focusable="false" viewBox="0 -666 500 688"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container></span> 的选手</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQLite</span></span><br><span class="line"><span class="keyword">select</span> q2.name, <span class="built_in">sum</span>(c) <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	(</span><br><span class="line">        <span class="keyword">select</span> a.name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> athletes <span class="keyword">as</span> a, medals <span class="keyword">as</span> m</span><br><span class="line">        <span class="keyword">where</span> a.disciplines <span class="operator">=</span> "['Judo']" <span class="keyword">and</span> m.discipline <span class="operator">=</span> <span class="string">'Judo'</span> <span class="keyword">and</span> m.winner_code <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.name</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    	<span class="keyword">select</span> p.name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (</span><br><span class="line">            <span class="keyword">select</span> a.name <span class="keyword">as</span> name, t.code <span class="keyword">as</span> t_code</span><br><span class="line">            <span class="keyword">from</span> athletes <span class="keyword">as</span> a, teams <span class="keyword">as</span> t</span><br><span class="line">            <span class="keyword">where</span> a.disciplines <span class="operator">=</span> "['Judo']" <span class="keyword">and</span> a.code <span class="operator">=</span> t.athletes_code</span><br><span class="line">        ) <span class="keyword">as</span> p, medals <span class="keyword">as</span> m</span><br><span class="line">        <span class="keyword">where</span> p.t_code <span class="operator">=</span> m.winner_code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> p.name</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> name,<span class="number">0</span> <span class="keyword">from</span> athletes <span class="keyword">where</span> disciplines <span class="operator">=</span> "['Judo']"</span><br><span class="line">	) <span class="keyword">as</span> q2</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> q2.name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s <span class="keyword">desc</span>, q2.name;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Duckdb</span></span><br><span class="line"><span class="keyword">select</span> q2.name, <span class="built_in">sum</span>(c) <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	(</span><br><span class="line">        <span class="keyword">select</span> a.name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> athletes <span class="keyword">as</span> a, medals <span class="keyword">as</span> m</span><br><span class="line">        <span class="keyword">where</span> a.disciplines <span class="operator">=</span> <span class="string">'[''Judo'']'</span> <span class="keyword">and</span> m.discipline <span class="operator">=</span> <span class="string">'Judo'</span> <span class="keyword">and</span> m.winner_code <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.name</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    	<span class="keyword">select</span> p.name <span class="keyword">as</span> name, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> (</span><br><span class="line">            <span class="keyword">select</span> a.name <span class="keyword">as</span> name, t.code <span class="keyword">as</span> t_code</span><br><span class="line">            <span class="keyword">from</span> athletes <span class="keyword">as</span> a, teams <span class="keyword">as</span> t</span><br><span class="line">            <span class="keyword">where</span> a.disciplines <span class="operator">=</span> <span class="string">'[''Judo'']'</span> <span class="keyword">and</span> a.code <span class="operator">=</span> t.athletes_code</span><br><span class="line">        ) <span class="keyword">as</span> p, medals <span class="keyword">as</span> m</span><br><span class="line">        <span class="keyword">where</span> p.t_code <span class="operator">=</span> m.winner_code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> p.name</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> name,<span class="number">0</span> <span class="keyword">from</span> athletes <span class="keyword">where</span> disciplines <span class="operator">=</span> <span class="string">'[''Judo'']'</span></span><br><span class="line">	) <span class="keyword">as</span> q2</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> q2.name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s <span class="keyword">desc</span>, q2.name;</span><br></pre></td></tr></table></figure></p></li>
<li><p>对于所有举办过田径项目的地点，列出所有在该地点比过赛的运动员，并按以其国籍所在国与代表国之间的距离为第一关键字降序、以名字为第二关键字字典序排序</p>
<p>分析：</p>
<p>先查所有举办过田径项目的地点所对应的比赛结果</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> r.participant_code <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue;</span><br></pre></td></tr></table></figure></p>
<p>再查人（还是分两部分，一部分个人，一部分队伍）</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.name <span class="keyword">as</span> ATHLETE_NAME, any_value(a.country_code) <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, any_value(a.nationality_code) <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">    <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">    <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">) <span class="keyword">as</span> rv, athletes <span class="keyword">as</span> a</span><br><span class="line"><span class="keyword">where</span> rv.pc <span class="operator">=</span> a.code</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.name;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.name <span class="keyword">as</span> ATHLETE_NAME, any_value(a.country_code) <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, any_value(a.nationality_code) <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">    <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">    <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">) <span class="keyword">as</span> rv, teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line"><span class="keyword">where</span> rv.pc <span class="operator">=</span> t.code <span class="keyword">and</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> a.name;</span><br></pre></td></tr></table></figure></p>
<p>再排序，有细节，注意只输出经纬度都不为空的数据，正确版本如下</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Duckdb</span></span><br><span class="line"><span class="keyword">with</span> res <span class="keyword">as</span> </span><br><span class="line">(</span><br><span class="line">        <span class="keyword">select</span> a.code, any_value(a.name) <span class="keyword">as</span> ATHLETE_NAME, any_value(a.country_code) <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, any_value(a.nationality_code) <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">            <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">        ) <span class="keyword">as</span> rv, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> rv.pc <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.code</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> a.code, any_value(a.name) <span class="keyword">as</span> ATHLETE_NAME, any_value(a.country_code) <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, any_value(a.nationality_code) <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">            <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">        ) <span class="keyword">as</span> rv, teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> rv.pc <span class="operator">=</span> t.code <span class="keyword">and</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.code</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> res.ATHLETE_NAME, res.REPRESENTED_COUNTRY_CODE, res.NATIONALITY_COUNTRY_CODE</span><br><span class="line"><span class="keyword">from</span> res, countries <span class="keyword">as</span> c1, countries <span class="keyword">as</span> c2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">(</span><br><span class="line">    res.REPRESENTED_COUNTRY_CODE <span class="operator">=</span> c1.code <span class="keyword">and</span> </span><br><span class="line">    res.NATIONALITY_COUNTRY_CODE <span class="operator">=</span> c2.code <span class="keyword">and</span></span><br><span class="line">    c1.Latitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c2.Latitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c1.Longitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c2.Longitude <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ((c1.Latitude<span class="operator">-</span>c2.Latitude)<span class="operator">*</span>(c1.Latitude<span class="operator">-</span>c2.Latitude)<span class="operator">+</span>(c1.Longitude<span class="operator">-</span>c2.Longitude)<span class="operator">*</span>(c1.Longitude<span class="operator">-</span>c2.Longitude)) <span class="keyword">desc</span>, res.ATHLETE_NAME;</span><br></pre></td></tr></table></figure></p>
<p>在之前我犯了一个错误出现了如下的结果</p>
<p>Std:</p>
<p><img src="https://p.ipic.vip/sxik4g.png" alt="image-20250111075602898" style="zoom:50%;"></p>
<p>My:</p>
<p><img src="https://p.ipic.vip/vhae0x.png" alt="image-20250111075649255" style="zoom:50%;"></p>
<p>怎么活？</p>
<p>排查结果是，有一个重名的选手，也就是名字一样但编号不一样，<code>union</code> 的时候我没输出编号，只输出了名字，所以 <code>union</code> 语句自己给去重了，警钟长鸣</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQLite</span></span><br><span class="line"><span class="keyword">with</span> res <span class="keyword">as</span> </span><br><span class="line">(</span><br><span class="line">        <span class="keyword">select</span> a.code, a.name <span class="keyword">as</span> ATHLETE_NAME, a.country_code <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, a.nationality_code <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">            <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">        ) <span class="keyword">as</span> rv, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> rv.pc <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.code</span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">        <span class="keyword">select</span> a.code, a.name <span class="keyword">as</span> ATHLETE_NAME, a.country_code <span class="keyword">as</span> REPRESENTED_COUNTRY_CODE, a.nationality_code <span class="keyword">as</span> NATIONALITY_COUNTRY_CODE</span><br><span class="line">        <span class="keyword">from</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.participant_code <span class="keyword">as</span> pc</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, venues <span class="keyword">as</span> v </span><br><span class="line">            <span class="keyword">where</span> v.disciplines <span class="keyword">like</span> <span class="string">'%Athletics%'</span> <span class="keyword">and</span> r.venue <span class="operator">=</span> v.venue</span><br><span class="line">        ) <span class="keyword">as</span> rv, teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line">        <span class="keyword">where</span> rv.pc <span class="operator">=</span> t.code <span class="keyword">and</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> a.code</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> res.ATHLETE_NAME, res.REPRESENTED_COUNTRY_CODE, res.NATIONALITY_COUNTRY_CODE</span><br><span class="line"><span class="keyword">from</span> res, countries <span class="keyword">as</span> c1, countries <span class="keyword">as</span> c2</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">(</span><br><span class="line">    res.REPRESENTED_COUNTRY_CODE <span class="operator">=</span> c1.code <span class="keyword">and</span> </span><br><span class="line">    res.NATIONALITY_COUNTRY_CODE <span class="operator">=</span> c2.code <span class="keyword">and</span></span><br><span class="line">    c1.Latitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c2.Latitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c1.Longitude <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">    c2.Longitude <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> ((c1.Latitude<span class="operator">-</span>c2.Latitude)<span class="operator">*</span>(c1.Latitude<span class="operator">-</span>c2.Latitude)<span class="operator">+</span>(c1.Longitude<span class="operator">-</span>c2.Longitude)<span class="operator">*</span>(c1.Longitude<span class="operator">-</span>c2.Longitude)) <span class="keyword">desc</span>, res.ATHLETE_NAME;</span><br></pre></td></tr></table></figure></p></li>
<li><p>对于每一天，找到当天在前五名（包括）中出现次数最多的国家，同时列出其人口排名和 GDP 排名，并按日期升序排序</p>
<p>分析：</p>
<p>先查每一天各个国家在前五名的记录，注意这里是 <code>union all</code></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, a.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">    <span class="keyword">from</span> results <span class="keyword">as</span> r, athletes <span class="keyword">as</span> a</span><br><span class="line">    <span class="keyword">where</span> r.participant_code <span class="operator">=</span> a.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">	<span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, t.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">	<span class="keyword">from</span> results <span class="keyword">as</span> r, (<span class="keyword">select</span> teams.code <span class="keyword">as</span> code, any_value(teams.country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> teams.code) <span class="keyword">as</span> t</span><br><span class="line">	<span class="keyword">where</span> r.participant_code <span class="operator">=</span> t.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span>;</span><br></pre></td></tr></table></figure></p>
<p>再通过横向查询算出每天各个国家在前五名中出现的次数</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tms <span class="keyword">as</span> </span><br><span class="line">(</span><br><span class="line">	<span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, a.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">    <span class="keyword">from</span> results <span class="keyword">as</span> r, athletes <span class="keyword">as</span> a</span><br><span class="line">    <span class="keyword">where</span> r.participant_code <span class="operator">=</span> a.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">	<span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">	<span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, t.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">	<span class="keyword">from</span> results <span class="keyword">as</span> r, (<span class="keyword">select</span> teams.code <span class="keyword">as</span> code, any_value(teams.country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> teams.code) <span class="keyword">as</span> t</span><br><span class="line">	<span class="keyword">where</span> r.participant_code <span class="operator">=</span> t.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> t1.date, t1.country_code, times.c</span><br><span class="line"><span class="keyword">from</span> tms <span class="keyword">as</span> t1, </span><br><span class="line">	<span class="keyword">lateral</span> </span><br><span class="line">	(</span><br><span class="line">        <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> tms <span class="keyword">as</span> t2</span><br><span class="line">        <span class="keyword">where</span> t2.date <span class="operator">=</span> t1.date <span class="keyword">and</span> t2.country_code <span class="operator">=</span> t1.country_code</span><br><span class="line">	) <span class="keyword">as</span> times</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> t1.date <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure></p>
<p>利用窗口函数得到每天次数最大的一个 tuple</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> max_t <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="operator">*</span>, </span><br><span class="line">        <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> mdt.date <span class="keyword">order</span> <span class="keyword">by</span> mdt.c <span class="keyword">desc</span>, mdt.country_code) <span class="keyword">as</span> rk</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">with</span> tms <span class="keyword">as</span> </span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, a.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, athletes <span class="keyword">as</span> a</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> a.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">            <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, t.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, (<span class="keyword">select</span> teams.code <span class="keyword">as</span> code, any_value(teams.country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> teams.code) <span class="keyword">as</span> t</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> t.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> t1.date <span class="keyword">as</span> <span class="type">date</span>, t1.country_code <span class="keyword">as</span> country_code, times.c <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> tms <span class="keyword">as</span> t1, </span><br><span class="line">            <span class="keyword">lateral</span> </span><br><span class="line">            (</span><br><span class="line">                <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">                <span class="keyword">from</span> tms <span class="keyword">as</span> t2</span><br><span class="line">                <span class="keyword">where</span> t2.date <span class="operator">=</span> t1.date <span class="keyword">and</span> t2.country_code <span class="operator">=</span> t1.country_code</span><br><span class="line">            ) <span class="keyword">as</span> times</span><br><span class="line">    ) <span class="keyword">as</span> mdt</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> m.date, m.country_code, m.c</span><br><span class="line"><span class="keyword">from</span> max_t <span class="keyword">as</span> m</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> m.date <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure></p>
<p>查询 GDP_rank 和 populartion_rank</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	code,  </span><br><span class="line">	<span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> Population <span class="keyword">desc</span>) <span class="keyword">as</span> rk_pop, </span><br><span class="line">	<span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> "GDP ($ per capita)" <span class="keyword">desc</span>) <span class="keyword">as</span> rk_GDP</span><br><span class="line"><span class="keyword">from</span> countries</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">	"GDP ($ per capita)" <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">	Population <span class="keyword">is</span> <span class="keyword">not null</span>;</span><br></pre></td></tr></table></figure></p>
<p>合并！排序！</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Duckdb</span></span><br><span class="line"><span class="keyword">with</span> max_t <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="operator">*</span>, </span><br><span class="line">        <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> mdt.date <span class="keyword">order</span> <span class="keyword">by</span> mdt.c <span class="keyword">desc</span>, mdt.country_code) <span class="keyword">as</span> rk</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">with</span> tms <span class="keyword">as</span> </span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, a.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, athletes <span class="keyword">as</span> a</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> a.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">            <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, t.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, (<span class="keyword">select</span> teams.code <span class="keyword">as</span> code, any_value(teams.country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> teams.code) <span class="keyword">as</span> t</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> t.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> t1.date <span class="keyword">as</span> <span class="type">date</span>, t1.country_code <span class="keyword">as</span> country_code, times.c <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> tms <span class="keyword">as</span> t1, </span><br><span class="line">            <span class="keyword">lateral</span> </span><br><span class="line">            (</span><br><span class="line">                <span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">                <span class="keyword">from</span> tms <span class="keyword">as</span> t2</span><br><span class="line">                <span class="keyword">where</span> t2.date <span class="operator">=</span> t1.date <span class="keyword">and</span> t2.country_code <span class="operator">=</span> t1.country_code</span><br><span class="line">            ) <span class="keyword">as</span> times</span><br><span class="line">    ) <span class="keyword">as</span> mdt</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> m.date <span class="keyword">as</span> <span class="type">date</span>, m.country_code <span class="keyword">as</span> country_code, m.c <span class="keyword">as</span> top5_appearances, ct_info.rk_GDP <span class="keyword">as</span> gdp_rank, ct_info.rk_pop <span class="keyword">as</span> population_rank</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	max_t <span class="keyword">as</span> m, </span><br><span class="line">	(</span><br><span class="line">    	<span class="keyword">select</span> </span><br><span class="line">            code,  </span><br><span class="line">            <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> Population <span class="keyword">desc</span>) <span class="keyword">as</span> rk_pop, </span><br><span class="line">            <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> "GDP ($ per capita)" <span class="keyword">desc</span>) <span class="keyword">as</span> rk_GDP</span><br><span class="line">        <span class="keyword">from</span> countries</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            "GDP ($ per capita)" <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">            Population <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">    ) <span class="keyword">as</span> ct_info</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> ct_info.code <span class="operator">=</span> m.country_code</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> m.date <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure></p>
<p><code>SQLite</code> 不支持横向查询 <code>lateral</code> 关键字</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQLite</span></span><br><span class="line"><span class="keyword">with</span> max_t <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        <span class="operator">*</span>, </span><br><span class="line">        <span class="built_in">row_number</span>() <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> mdt.date <span class="keyword">order</span> <span class="keyword">by</span> mdt.c <span class="keyword">desc</span>, mdt.country_code) <span class="keyword">as</span> rk</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">with</span> tms <span class="keyword">as</span> </span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, a.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, athletes <span class="keyword">as</span> a</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> a.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">            <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">            <span class="keyword">select</span> r.date <span class="keyword">as</span> <span class="type">date</span>, t.country_code <span class="keyword">as</span> country_code, r.rank</span><br><span class="line">            <span class="keyword">from</span> results <span class="keyword">as</span> r, (<span class="keyword">select</span> teams.code <span class="keyword">as</span> code, teams.country_code <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> teams.code) <span class="keyword">as</span> t</span><br><span class="line">            <span class="keyword">where</span> r.participant_code <span class="operator">=</span> t.code <span class="keyword">and</span> r.rank <span class="operator">&lt;=</span> <span class="number">5</span> <span class="keyword">and</span> r.rank <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">distinct</span> t1.date <span class="keyword">as</span> <span class="type">date</span>, t1.country_code <span class="keyword">as</span> country_code, times.c <span class="keyword">as</span> c</span><br><span class="line">        <span class="keyword">from</span> tms <span class="keyword">as</span> t1</span><br><span class="line">        <span class="keyword">left</span> <span class="keyword">join</span></span><br><span class="line">       	(</span><br><span class="line">        	<span class="keyword">select</span> t2.date, t2.country_code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c</span><br><span class="line">            <span class="keyword">from</span> tms <span class="keyword">as</span> t2</span><br><span class="line">            <span class="keyword">group</span> <span class="keyword">by</span> t2.date, t2.country_code</span><br><span class="line">        ) <span class="keyword">as</span> times</span><br><span class="line">        <span class="keyword">on</span> t1.date <span class="operator">=</span> times.date <span class="keyword">and</span> t1.country_code <span class="operator">=</span> times.country_code</span><br><span class="line">    ) <span class="keyword">as</span> mdt</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> m.date <span class="keyword">as</span> <span class="type">date</span>, m.country_code <span class="keyword">as</span> country_code, m.c <span class="keyword">as</span> top5_appearances, ct_info.rk_GDP <span class="keyword">as</span> gdp_rank, ct_info.rk_pop <span class="keyword">as</span> population_rank</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	max_t <span class="keyword">as</span> m, </span><br><span class="line">	(</span><br><span class="line">    	<span class="keyword">select</span> </span><br><span class="line">            code,  </span><br><span class="line">            <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> Population <span class="keyword">desc</span>) <span class="keyword">as</span> rk_pop, </span><br><span class="line">            <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> "GDP ($ per capita)" <span class="keyword">desc</span>) <span class="keyword">as</span> rk_GDP</span><br><span class="line">        <span class="keyword">from</span> countries</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            "GDP ($ per capita)" <span class="keyword">is</span> <span class="keyword">not null</span> <span class="keyword">and</span></span><br><span class="line">            Population <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">    ) <span class="keyword">as</span> ct_info</span><br><span class="line"><span class="keyword">where</span> rk <span class="operator">=</span> <span class="number">1</span> <span class="keyword">and</span> ct_info.code <span class="operator">=</span> m.country_code</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> m.date <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure></p></li>
<li><p>对比于东京奥运会，列出在金牌数量上有最大进步的五个国家，对于这五个国家，列出所属所有全女生的队伍，并按以提升的金牌数为第一关键字降序、以国家 code 为第二关键字字典序、以队伍 code 为第三关键字字典序排序</p>
<p>分析：</p>
<p>先查出所有国家的金牌数量</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s1.cc, <span class="built_in">sum</span>(s)</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">    <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, athletes <span class="keyword">as</span> a, medal_info <span class="keyword">as</span> mi</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">    	m.winner_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">    	a.country_code <span class="operator">=</span> c.code <span class="keyword">and</span> </span><br><span class="line">    	mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span> </span><br><span class="line">    	mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">    <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, (<span class="keyword">select</span> code, any_value(country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t, medal_info <span class="keyword">as</span> mi</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">	m.winner_code <span class="operator">=</span> t.code <span class="keyword">and</span> </span><br><span class="line">    	t.country_code <span class="operator">=</span> c.code <span class="keyword">and</span></span><br><span class="line">	mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span></span><br><span class="line">    	mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">) <span class="keyword">as</span> s1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cc;</span><br></pre></td></tr></table></figure></p>
<p>再查出所有国家进步的金牌数量，以及前五</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	s1.cc, </span><br><span class="line">	(<span class="built_in">sum</span>(s)<span class="operator">-</span>any_value(tm.gold_medal)) <span class="keyword">as</span> increased_gold_medal_number, </span><br><span class="line">	<span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> increased_gold_medal_number <span class="keyword">desc</span>) <span class="keyword">as</span> rk</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">    <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, athletes <span class="keyword">as</span> a, medal_info <span class="keyword">as</span> mi</span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    	m.winner_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">    	a.country_code <span class="operator">=</span> c.code <span class="keyword">and</span> </span><br><span class="line">    	mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span> </span><br><span class="line">    	mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">    <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, (<span class="keyword">select</span> code, any_value(country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t, medal_info <span class="keyword">as</span> mi</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">    	m.winner_code <span class="operator">=</span> t.code <span class="keyword">and</span> </span><br><span class="line">    	t.country_code <span class="operator">=</span> c.code <span class="keyword">and</span></span><br><span class="line">    	mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span></span><br><span class="line">    	mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">) <span class="keyword">as</span> s1 <span class="keyword">left</span> <span class="keyword">join</span> tokyo_medals <span class="keyword">as</span> tm</span><br><span class="line"><span class="keyword">on</span> s1.cc <span class="operator">=</span> tm.country_code</span><br><span class="line"><span class="keyword">where</span> tm.gold_medal <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cc</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> rk</span><br><span class="line">limit <span class="number">5</span>;</span><br></pre></td></tr></table></figure></p>
<p>找全女队</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> sm1 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, any_value(t.country_code) <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line">    <span class="keyword">where</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">),</span><br><span class="line">sm2 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, any_value(t.country_code) <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a, gender <span class="keyword">as</span> g</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        t.athletes_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">        a.gender <span class="operator">=</span> g.id <span class="keyword">and</span> </span><br><span class="line">        g.name <span class="operator">=</span> <span class="string">'Female'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> sm1.cc, sm1.code</span><br><span class="line"><span class="keyword">from</span> sm1, sm2</span><br><span class="line"><span class="keyword">where</span> sm1.code <span class="operator">=</span> sm2.code <span class="keyword">and</span> sm1.c <span class="operator">=</span> sm2.c;</span><br></pre></td></tr></table></figure></p>
<p>合并！排序！</p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Duckdb</span></span><br><span class="line"><span class="keyword">with</span> tmp <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        s1.cc, </span><br><span class="line">        (<span class="built_in">sum</span>(s)<span class="operator">-</span>any_value(tm.gold_medal)) <span class="keyword">as</span> increased_gold_medal_number, </span><br><span class="line">        <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> increased_gold_medal_number <span class="keyword">desc</span>) <span class="keyword">as</span> rk</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">        <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, athletes <span class="keyword">as</span> a, medal_info <span class="keyword">as</span> mi</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            m.winner_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">            a.country_code <span class="operator">=</span> c.code <span class="keyword">and</span> </span><br><span class="line">            mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span> </span><br><span class="line">            mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">        <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, (<span class="keyword">select</span> code, any_value(country_code) <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t, medal_info <span class="keyword">as</span> mi</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            m.winner_code <span class="operator">=</span> t.code <span class="keyword">and</span> </span><br><span class="line">            t.country_code <span class="operator">=</span> c.code <span class="keyword">and</span></span><br><span class="line">            mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span></span><br><span class="line">            mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">    ) <span class="keyword">as</span> s1 <span class="keyword">left</span> <span class="keyword">join</span> tokyo_medals <span class="keyword">as</span> tm</span><br><span class="line">    <span class="keyword">on</span> s1.cc <span class="operator">=</span> tm.country_code</span><br><span class="line">    <span class="keyword">where</span> tm.gold_medal <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> cc</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> rk</span><br><span class="line">    limit <span class="number">5</span></span><br><span class="line">),</span><br><span class="line">sm1 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, any_value(t.country_code) <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line">    <span class="keyword">where</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">),</span><br><span class="line">sm2 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, any_value(t.country_code) <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a, gender <span class="keyword">as</span> g</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        t.athletes_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">        a.gender <span class="operator">=</span> g.id <span class="keyword">and</span> </span><br><span class="line">        g.name <span class="operator">=</span> <span class="string">'Female'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> tmp.cc <span class="keyword">as</span> country_code, tmp.increased_gold_medal_number <span class="keyword">as</span> increased_gold_medal_number, sm1.code <span class="keyword">as</span> team_code</span><br><span class="line"><span class="keyword">from</span> sm1, sm2, tmp</span><br><span class="line"><span class="keyword">where</span> tmp.cc <span class="operator">=</span> sm1.cc <span class="keyword">and</span> sm1.code <span class="operator">=</span> sm2.code <span class="keyword">and</span> sm1.c <span class="operator">=</span> sm2.c</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> increased_gold_medal_number <span class="keyword">desc</span>, country_code, team_code;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQLite</span></span><br><span class="line"><span class="keyword">with</span> tmp <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> </span><br><span class="line">        s1.cc, </span><br><span class="line">        (<span class="built_in">sum</span>(s)<span class="operator">-</span>tm.gold_medal) <span class="keyword">as</span> increased_gold_medal_number, </span><br><span class="line">        <span class="built_in">rank</span>() <span class="keyword">over</span> (<span class="keyword">order</span> <span class="keyword">by</span> (<span class="built_in">sum</span>(s)<span class="operator">-</span>tm.gold_medal) <span class="keyword">desc</span>) <span class="keyword">as</span> rk</span><br><span class="line">    <span class="keyword">from</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">        <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, athletes <span class="keyword">as</span> a, medal_info <span class="keyword">as</span> mi</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            m.winner_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">            a.country_code <span class="operator">=</span> c.code <span class="keyword">and</span> </span><br><span class="line">            mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span> </span><br><span class="line">            mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">        <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">        <span class="keyword">select</span> c.code <span class="keyword">as</span> cc, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> s</span><br><span class="line">        <span class="keyword">from</span> medals <span class="keyword">as</span> m, countries <span class="keyword">as</span> c, (<span class="keyword">select</span> code, country_code <span class="keyword">as</span> country_code <span class="keyword">from</span> teams <span class="keyword">group</span> <span class="keyword">by</span> code) <span class="keyword">as</span> t, medal_info <span class="keyword">as</span> mi</span><br><span class="line">        <span class="keyword">where</span> </span><br><span class="line">            m.winner_code <span class="operator">=</span> t.code <span class="keyword">and</span> </span><br><span class="line">            t.country_code <span class="operator">=</span> c.code <span class="keyword">and</span></span><br><span class="line">            mi.code <span class="operator">=</span> m.medal_code <span class="keyword">and</span></span><br><span class="line">            mi.name <span class="operator">=</span> <span class="string">'Gold Medal'</span></span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> c.code</span><br><span class="line">    ) <span class="keyword">as</span> s1 <span class="keyword">left</span> <span class="keyword">join</span> tokyo_medals <span class="keyword">as</span> tm</span><br><span class="line">    <span class="keyword">on</span> s1.cc <span class="operator">=</span> tm.country_code</span><br><span class="line">    <span class="keyword">where</span> tm.gold_medal <span class="keyword">is</span> <span class="keyword">not null</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> cc</span><br><span class="line">    <span class="keyword">order</span> <span class="keyword">by</span> rk</span><br><span class="line">    limit <span class="number">5</span></span><br><span class="line">),</span><br><span class="line">sm1 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, t.country_code <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a</span><br><span class="line">    <span class="keyword">where</span> t.athletes_code <span class="operator">=</span> a.code</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">),</span><br><span class="line">sm2 <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> t.code <span class="keyword">as</span> code, <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">as</span> c, t.country_code <span class="keyword">as</span> cc</span><br><span class="line">    <span class="keyword">from</span> teams <span class="keyword">as</span> t, athletes <span class="keyword">as</span> a, gender <span class="keyword">as</span> g</span><br><span class="line">    <span class="keyword">where</span> </span><br><span class="line">        t.athletes_code <span class="operator">=</span> a.code <span class="keyword">and</span> </span><br><span class="line">        a.gender <span class="operator">=</span> g.id <span class="keyword">and</span> </span><br><span class="line">        g.name <span class="operator">=</span> <span class="string">'Female'</span></span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> t.code</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> tmp.cc <span class="keyword">as</span> country_code, tmp.increased_gold_medal_number <span class="keyword">as</span> increased_gold_medal_number, sm1.code <span class="keyword">as</span> team_code</span><br><span class="line"><span class="keyword">from</span> sm1, sm2, tmp</span><br><span class="line"><span class="keyword">where</span> tmp.cc <span class="operator">=</span> sm1.cc <span class="keyword">and</span> sm1.code <span class="operator">=</span> sm2.code <span class="keyword">and</span> sm1.c <span class="operator">=</span> sm2.c</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> increased_gold_medal_number <span class="keyword">desc</span>, country_code, team_code;</span><br></pre></td></tr></table></figure></p></li>
</ol>

    </div>

    
    <div class="about">
        <h1>关于本文</h1>
        <div class="details">
            <p>由 wsy_jim 撰写, 采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a> 许可协议.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CMU/" class="tag">#CMU</a><a href="/tags/Databases/" class="tag">#Databases</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        
        <a href="/2024/12/27/better-terminal/" class="next">
            <div>
                <div class="text">
                    <p class="label">下一篇</p>
                    <h3 class="title">更好的终端模组</h3>
                </div>
            </div>
        </a>
        
        
        <a href="/2024/12/09/CMU15445-learning-note-pro/" class="prev">
            <div>
                <div class="text">
                    <p class="label">上一篇</p>
                    <h3 class="title">CMU15445项目笔记</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
        <script src="https://giscus.app/client.js" data-repo="wsyunine/blog_comments" data-repo-id="R_kgDON37drA" data-category="Announcements" data-category-id="DIC_kwDON37drM4Cm5_n" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="preferred_color_scheme" data-lang="zh-CN" crossorigin="anonymous" async> </script>
        
    
</article>


        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/guestbook" class="item">Guestbook</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/wsyunine" class="item">GitHub</a>
                
                <a target="_blank" rel="noopener" href="https://discord.gg/wsy_jim" class="item">Discord</a>
                
                <a href="mailto:3340307001@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 wsy_jim<br>由 <a href="http://hexo.io/" target="_blank">Hexo</a> 驱动 </span>
        
        <br>
        <span class="footer-extra-description">玄之又玄，众妙之门。</span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>

    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Lenis script loaded!");
        
        const lenis = new Lenis({
            smooth: true,
            lerp: 0.1,
            wheelMultiplier: 1,
            touchMultiplier: 2,
            infinite: false
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);
    });
    </script>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>